require=function s(o,a,u){function c(n,t){if(!a[n]){if(!o[n]){var e="function"==typeof require&&require;if(!t&&e)return e(n,!0);if(h)return h(n,!0);var i=new Error("Cannot find module '"+n+"'");throw i.code="MODULE_NOT_FOUND",i}var r=a[n]={exports:{}};o[n][0].call(r.exports,function(t){var e=o[n][1][t];return c(e||t)},r,r.exports,s,o,a,u)}return a[n].exports}for(var h="function"==typeof require&&require,t=0;t<u.length;t++)c(u[t]);return c}({1:[function($,n,i){(function(B,H){var t,e;t=this,e=function(){"use strict";function c(t){return"function"==typeof t}var n=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)},i=0,e=void 0,r=void 0,a=function(t,e){f[i]=t,f[i+1]=e,2===(i+=2)&&(r?r(d):m())};var t="undefined"!=typeof window?window:void 0,s=t||{},o=s.MutationObserver||s.WebKitMutationObserver,u="undefined"==typeof self&&void 0!==B&&"[object process]"==={}.toString.call(B),h="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel;function l(){var t=setTimeout;return function(){return t(d,1)}}var f=new Array(1e3);function d(){for(var t=0;t<i;t+=2){(0,f[t])(f[t+1]),f[t]=void 0,f[t+1]=void 0}i=0}var p,v,_,y,m=void 0;function g(t,e){var n=this,i=new this.constructor(x);void 0===i[S]&&D(i);var r=n._state;if(r){var s=arguments[r-1];a(function(){return R(r,i,s,n._result)})}else M(n,i,t,e);return i}function b(t){if(t&&"object"==typeof t&&t.constructor===this)return t;var e=new this(x);return k(e,t),e}u?m=function(){return B.nextTick(d)}:o?(v=0,_=new o(d),y=document.createTextNode(""),_.observe(y,{characterData:!0}),m=function(){y.data=v=++v%2}):h?((p=new MessageChannel).port1.onmessage=d,m=function(){return p.port2.postMessage(0)}):m=void 0===t&&"function"==typeof $?function(){try{var t=Function("return this")().require("vertx");return void 0!==(e=t.runOnLoop||t.runOnContext)?function(){e(d)}:l()}catch(t){return l()}}():l();var S=Math.random().toString(36).substring(2);function x(){}var P=void 0,w=1,A=2,O={error:null};function T(t){try{return t.then}catch(t){return O.error=t,O}}function N(t,e,n){var i,r,s,o;e.constructor===t.constructor&&n===g&&e.constructor.resolve===b?(s=t,(o=e)._state===w?F(s,o._result):o._state===A?E(s,o._result):M(o,void 0,function(t){return k(s,t)},function(t){return E(s,t)})):n===O?(E(t,O.error),O.error=null):void 0===n?F(t,e):c(n)?(i=e,r=n,a(function(e){var n=!1,t=function(t,e,n,i){try{t.call(e,n,i)}catch(t){return t}}(r,i,function(t){n||(n=!0,i!==t?k(e,t):F(e,t))},function(t){n||(n=!0,E(e,t))},e._label);!n&&t&&(n=!0,E(e,t))},t)):F(t,e)}function k(t,e){var n,i;t===e?E(t,new TypeError("You cannot resolve a promise with itself")):(i=typeof(n=e),null===n||"object"!==i&&"function"!==i?F(t,e):N(t,e,T(e)))}function j(t){t._onerror&&t._onerror(t._result),U(t)}function F(t,e){t._state===P&&(t._result=e,t._state=w,0!==t._subscribers.length&&a(U,t))}function E(t,e){t._state===P&&(t._state=A,t._result=e,a(j,t))}function M(t,e,n,i){var r=t._subscribers,s=r.length;t._onerror=null,r[s]=e,r[s+w]=n,r[s+A]=i,0===s&&t._state&&a(U,t)}function U(t){var e=t._subscribers,n=t._state;if(0!==e.length){for(var i=void 0,r=void 0,s=t._result,o=0;o<e.length;o+=3)i=e[o],r=e[o+n],i?R(n,i,r,s):r(s);t._subscribers.length=0}}function R(t,e,n,i){var r=c(n),s=void 0,o=void 0,a=void 0,u=void 0;if(r){if((s=function(t,e){try{return t(e)}catch(t){return O.error=t,O}}(n,i))===O?(u=!0,o=s.error,s.error=null):a=!0,e===s)return void E(e,new TypeError("A promises callback cannot return that same promise."))}else s=i,a=!0;e._state!==P||(r&&a?k(e,s):u?E(e,o):t===w?F(e,s):t===A&&E(e,s))}var C=0;function D(t){t[S]=C++,t._state=void 0,t._result=void 0,t._subscribers=[]}var I=function(){function t(t,e){this._instanceConstructor=t,this.promise=new t(x),this.promise[S]||D(this.promise),n(e)?(this.length=e.length,this._remaining=e.length,this._result=new Array(this.length),0===this.length?F(this.promise,this._result):(this.length=this.length||0,this._enumerate(e),0===this._remaining&&F(this.promise,this._result))):E(this.promise,new Error("Array Methods must be provided an Array"))}return t.prototype._enumerate=function(t){for(var e=0;this._state===P&&e<t.length;e++)this._eachEntry(t[e],e)},t.prototype._eachEntry=function(e,t){var n=this._instanceConstructor,i=n.resolve;if(i===b){var r=T(e);if(r===g&&e._state!==P)this._settledAt(e._state,t,e._result);else if("function"!=typeof r)this._remaining--,this._result[t]=e;else if(n===L){var s=new n(x);N(s,e,r),this._willSettleAt(s,t)}else this._willSettleAt(new n(function(t){return t(e)}),t)}else this._willSettleAt(i(e),t)},t.prototype._settledAt=function(t,e,n){var i=this.promise;i._state===P&&(this._remaining--,t===A?E(i,n):this._result[e]=n),0===this._remaining&&F(i,this._result)},t.prototype._willSettleAt=function(t,e){var n=this;M(t,void 0,function(t){return n._settledAt(w,e,t)},function(t){return n._settledAt(A,e,t)})},t}();var L=function(){function e(t){this[S]=C++,this._result=this._state=void 0,this._subscribers=[],x!==t&&("function"!=typeof t&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof e?function(e,t){try{t(function(t){k(e,t)},function(t){E(e,t)})}catch(t){E(e,t)}}(this,t):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}return e.prototype.catch=function(t){return this.then(null,t)},e.prototype.finally=function(e){var n=this.constructor;return this.then(function(t){return n.resolve(e()).then(function(){return t})},function(t){return n.resolve(e()).then(function(){throw t})})},e}();return L.prototype.then=g,L.all=function(t){return new I(this,t).promise},L.race=function(r){var s=this;return n(r)?new s(function(t,e){for(var n=r.length,i=0;i<n;i++)s.resolve(r[i]).then(t,e)}):new s(function(t,e){return e(new TypeError("You must pass an array to race."))})},L.resolve=b,L.reject=function(t){var e=new this(x);return E(e,t),e},L._setScheduler=function(t){r=t},L._setAsap=function(t){a=t},L._asap=a,L.polyfill=function(){var t=void 0;if(void 0!==H)t=H;else if("undefined"!=typeof self)t=self;else try{t=Function("return this")()}catch(t){throw new Error("polyfill failed because global object is unavailable in this environment")}var e=t.Promise;if(e){var n=null;try{n=Object.prototype.toString.call(e.resolve())}catch(t){}if("[object Promise]"===n&&!e.cast)return}t.Promise=L},L.Promise=L},"object"==typeof i&&void 0!==n?n.exports=e():"function"==typeof define&&define.amd?define(e):t.ES6Promise=e()}).call(this,$("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:2}],2:[function(t,e,n){var i,r,s=e.exports={};function o(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function u(e){if(i===setTimeout)return setTimeout(e,0);if((i===o||!i)&&setTimeout)return i=setTimeout,setTimeout(e,0);try{return i(e,0)}catch(t){try{return i.call(null,e,0)}catch(t){return i.call(this,e,0)}}}!function(){try{i="function"==typeof setTimeout?setTimeout:o}catch(t){i=o}try{r="function"==typeof clearTimeout?clearTimeout:a}catch(t){r=a}}();var c,h=[],l=!1,f=-1;function d(){l&&c&&(l=!1,c.length?h=c.concat(h):f=-1,h.length&&p())}function p(){if(!l){var t=u(d);l=!0;for(var e=h.length;e;){for(c=h,h=[];++f<e;)c&&c[f].run();f=-1,e=h.length}c=null,l=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===a||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(t)}}function v(t,e){this.fun=t,this.array=e}function _(){}s.nextTick=function(t){var e=new Array(arguments.length-1);if(1<arguments.length)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];h.push(new v(t,e)),1!==h.length||l||u(p)},v.prototype.run=function(){this.fun.apply(null,this.array)},s.title="browser",s.browser=!0,s.env={},s.argv=[],s.version="",s.versions={},s.on=_,s.addListener=_,s.once=_,s.off=_,s.removeListener=_,s.removeAllListeners=_,s.emit=_,s.prependListener=_,s.prependOnceListener=_,s.listeners=function(t){return[]},s.binding=function(t){throw new Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(t){throw new Error("process.chdir is not supported")},s.umask=function(){return 0}},{}],3:[function(t,$,q){(function(){var t=this,e=t._,i=Array.prototype,o=Object.prototype,n=Function.prototype,r=i.push,u=i.slice,l=o.toString,s=o.hasOwnProperty,a=Array.isArray,c=Object.keys,h=n.bind,f=Object.create,d=function(){},p=function(t){return t instanceof p?t:this instanceof p?void(this._wrapped=t):new p(t)};void 0!==q?(void 0!==$&&$.exports&&(q=$.exports=p),q._=p):t._=p,p.VERSION="1.8.3";var v=function(r,s,t){if(void 0===s)return r;switch(null==t?3:t){case 1:return function(t){return r.call(s,t)};case 2:return function(t,e){return r.call(s,t,e)};case 3:return function(t,e,n){return r.call(s,t,e,n)};case 4:return function(t,e,n,i){return r.call(s,t,e,n,i)}}return function(){return r.apply(s,arguments)}},_=function(t,e,n){return null==t?p.identity:p.isFunction(t)?v(t,e,n):p.isObject(t)?p.matcher(t):p.property(t)};p.iteratee=function(t,e){return _(t,e,1/0)};var y=function(u,c){return function(t){var e=arguments.length;if(e<2||null==t)return t;for(var n=1;n<e;n++)for(var i=arguments[n],r=u(i),s=r.length,o=0;o<s;o++){var a=r[o];c&&void 0!==t[a]||(t[a]=i[a])}return t}},m=function(t){if(!p.isObject(t))return{};if(f)return f(t);d.prototype=t;var e=new d;return d.prototype=null,e},g=function(e){return function(t){return null==t?void 0:t[e]}},b=Math.pow(2,53)-1,S=g("length"),x=function(t){var e=S(t);return"number"==typeof e&&0<=e&&e<=b};function P(a){return function(t,e,n,i){e=v(e,i,4);var r=!x(t)&&p.keys(t),s=(r||t).length,o=0<a?0:s-1;return arguments.length<3&&(n=t[r?r[o]:o],o+=a),function(t,e,n,i,r,s){for(;0<=r&&r<s;r+=a){var o=i?i[r]:r;n=e(n,t[o],o,t)}return n}(t,e,n,r,o,s)}}p.each=p.forEach=function(t,e,n){var i,r;if(e=v(e,n),x(t))for(i=0,r=t.length;i<r;i++)e(t[i],i,t);else{var s=p.keys(t);for(i=0,r=s.length;i<r;i++)e(t[s[i]],s[i],t)}return t},p.map=p.collect=function(t,e,n){e=_(e,n);for(var i=!x(t)&&p.keys(t),r=(i||t).length,s=Array(r),o=0;o<r;o++){var a=i?i[o]:o;s[o]=e(t[a],a,t)}return s},p.reduce=p.foldl=p.inject=P(1),p.reduceRight=p.foldr=P(-1),p.find=p.detect=function(t,e,n){var i;if(void 0!==(i=x(t)?p.findIndex(t,e,n):p.findKey(t,e,n))&&-1!==i)return t[i]},p.filter=p.select=function(t,i,e){var r=[];return i=_(i,e),p.each(t,function(t,e,n){i(t,e,n)&&r.push(t)}),r},p.reject=function(t,e,n){return p.filter(t,p.negate(_(e)),n)},p.every=p.all=function(t,e,n){e=_(e,n);for(var i=!x(t)&&p.keys(t),r=(i||t).length,s=0;s<r;s++){var o=i?i[s]:s;if(!e(t[o],o,t))return!1}return!0},p.some=p.any=function(t,e,n){e=_(e,n);for(var i=!x(t)&&p.keys(t),r=(i||t).length,s=0;s<r;s++){var o=i?i[s]:s;if(e(t[o],o,t))return!0}return!1},p.contains=p.includes=p.include=function(t,e,n,i){return x(t)||(t=p.values(t)),("number"!=typeof n||i)&&(n=0),0<=p.indexOf(t,e,n)},p.invoke=function(t,n){var i=u.call(arguments,2),r=p.isFunction(n);return p.map(t,function(t){var e=r?n:t[n];return null==e?e:e.apply(t,i)})},p.pluck=function(t,e){return p.map(t,p.property(e))},p.where=function(t,e){return p.filter(t,p.matcher(e))},p.findWhere=function(t,e){return p.find(t,p.matcher(e))},p.max=function(t,i,e){var n,r,s=-1/0,o=-1/0;if(null==i&&null!=t)for(var a=0,u=(t=x(t)?t:p.values(t)).length;a<u;a++)n=t[a],s<n&&(s=n);else i=_(i,e),p.each(t,function(t,e,n){r=i(t,e,n),(o<r||r===-1/0&&s===-1/0)&&(s=t,o=r)});return s},p.min=function(t,i,e){var n,r,s=1/0,o=1/0;if(null==i&&null!=t)for(var a=0,u=(t=x(t)?t:p.values(t)).length;a<u;a++)(n=t[a])<s&&(s=n);else i=_(i,e),p.each(t,function(t,e,n){((r=i(t,e,n))<o||r===1/0&&s===1/0)&&(s=t,o=r)});return s},p.shuffle=function(t){for(var e,n=x(t)?t:p.values(t),i=n.length,r=Array(i),s=0;s<i;s++)(e=p.random(0,s))!==s&&(r[s]=r[e]),r[e]=n[s];return r},p.sample=function(t,e,n){return null==e||n?(x(t)||(t=p.values(t)),t[p.random(t.length-1)]):p.shuffle(t).slice(0,Math.max(0,e))},p.sortBy=function(t,i,e){return i=_(i,e),p.pluck(p.map(t,function(t,e,n){return{value:t,index:e,criteria:i(t,e,n)}}).sort(function(t,e){var n=t.criteria,i=e.criteria;if(n!==i){if(i<n||void 0===n)return 1;if(n<i||void 0===i)return-1}return t.index-e.index}),"value")};var w=function(o){return function(i,r,t){var s={};return r=_(r,t),p.each(i,function(t,e){var n=r(t,e,i);o(s,t,n)}),s}};p.groupBy=w(function(t,e,n){p.has(t,n)?t[n].push(e):t[n]=[e]}),p.indexBy=w(function(t,e,n){t[n]=e}),p.countBy=w(function(t,e,n){p.has(t,n)?t[n]++:t[n]=1}),p.toArray=function(t){return t?p.isArray(t)?u.call(t):x(t)?p.map(t,p.identity):p.values(t):[]},p.size=function(t){return null==t?0:x(t)?t.length:p.keys(t).length},p.partition=function(t,i,e){i=_(i,e);var r=[],s=[];return p.each(t,function(t,e,n){(i(t,e,n)?r:s).push(t)}),[r,s]},p.first=p.head=p.take=function(t,e,n){if(null!=t)return null==e||n?t[0]:p.initial(t,t.length-e)},p.initial=function(t,e,n){return u.call(t,0,Math.max(0,t.length-(null==e||n?1:e)))},p.last=function(t,e,n){if(null!=t)return null==e||n?t[t.length-1]:p.rest(t,Math.max(0,t.length-e))},p.rest=p.tail=p.drop=function(t,e,n){return u.call(t,null==e||n?1:e)},p.compact=function(t){return p.filter(t,p.identity)};var A=function(t,e,n,i){for(var r=[],s=0,o=i||0,a=S(t);o<a;o++){var u=t[o];if(x(u)&&(p.isArray(u)||p.isArguments(u))){e||(u=A(u,e,n));var c=0,h=u.length;for(r.length+=h;c<h;)r[s++]=u[c++]}else n||(r[s++]=u)}return r};function O(s){return function(t,e,n){e=_(e,n);for(var i=S(t),r=0<s?0:i-1;0<=r&&r<i;r+=s)if(e(t[r],r,t))return r;return-1}}function T(s,o,a){return function(t,e,n){var i=0,r=S(t);if("number"==typeof n)0<s?i=0<=n?n:Math.max(n+r,i):r=0<=n?Math.min(n+1,r):n+r+1;else if(a&&n&&r)return t[n=a(t,e)]===e?n:-1;if(e!=e)return 0<=(n=o(u.call(t,i,r),p.isNaN))?n+i:-1;for(n=0<s?i:r-1;0<=n&&n<r;n+=s)if(t[n]===e)return n;return-1}}p.flatten=function(t,e){return A(t,e,!1)},p.without=function(t){return p.difference(t,u.call(arguments,1))},p.uniq=p.unique=function(t,e,n,i){p.isBoolean(e)||(i=n,n=e,e=!1),null!=n&&(n=_(n,i));for(var r=[],s=[],o=0,a=S(t);o<a;o++){var u=t[o],c=n?n(u,o,t):u;e?(o&&s===c||r.push(u),s=c):n?p.contains(s,c)||(s.push(c),r.push(u)):p.contains(r,u)||r.push(u)}return r},p.union=function(){return p.uniq(A(arguments,!0,!0))},p.intersection=function(t){for(var e=[],n=arguments.length,i=0,r=S(t);i<r;i++){var s=t[i];if(!p.contains(e,s)){for(var o=1;o<n&&p.contains(arguments[o],s);o++);o===n&&e.push(s)}}return e},p.difference=function(t){var e=A(arguments,!0,!0,1);return p.filter(t,function(t){return!p.contains(e,t)})},p.zip=function(){return p.unzip(arguments)},p.unzip=function(t){for(var e=t&&p.max(t,S).length||0,n=Array(e),i=0;i<e;i++)n[i]=p.pluck(t,i);return n},p.object=function(t,e){for(var n={},i=0,r=S(t);i<r;i++)e?n[t[i]]=e[i]:n[t[i][0]]=t[i][1];return n},p.findIndex=O(1),p.findLastIndex=O(-1),p.sortedIndex=function(t,e,n,i){for(var r=(n=_(n,i,1))(e),s=0,o=S(t);s<o;){var a=Math.floor((s+o)/2);n(t[a])<r?s=a+1:o=a}return s},p.indexOf=T(1,p.findIndex,p.sortedIndex),p.lastIndexOf=T(-1,p.findLastIndex),p.range=function(t,e,n){null==e&&(e=t||0,t=0),n=n||1;for(var i=Math.max(Math.ceil((e-t)/n),0),r=Array(i),s=0;s<i;s++,t+=n)r[s]=t;return r};var N=function(t,e,n,i,r){if(!(i instanceof e))return t.apply(n,r);var s=m(t.prototype),o=t.apply(s,r);return p.isObject(o)?o:s};p.bind=function(t,e){if(h&&t.bind===h)return h.apply(t,u.call(arguments,1));if(!p.isFunction(t))throw new TypeError("Bind must be called on a function");var n=u.call(arguments,2),i=function(){return N(t,i,e,this,n.concat(u.call(arguments)))};return i},p.partial=function(r){var s=u.call(arguments,1),o=function(){for(var t=0,e=s.length,n=Array(e),i=0;i<e;i++)n[i]=s[i]===p?arguments[t++]:s[i];for(;t<arguments.length;)n.push(arguments[t++]);return N(r,o,this,this,n)};return o},p.bindAll=function(t){var e,n,i=arguments.length;if(i<=1)throw new Error("bindAll must be passed function names");for(e=1;e<i;e++)t[n=arguments[e]]=p.bind(t[n],t);return t},p.memoize=function(i,r){var s=function(t){var e=s.cache,n=""+(r?r.apply(this,arguments):t);return p.has(e,n)||(e[n]=i.apply(this,arguments)),e[n]};return s.cache={},s},p.delay=function(t,e){var n=u.call(arguments,2);return setTimeout(function(){return t.apply(null,n)},e)},p.defer=p.partial(p.delay,p,1),p.throttle=function(n,i,r){var s,o,a,u=null,c=0;r||(r={});var h=function(){c=!1===r.leading?0:p.now(),u=null,a=n.apply(s,o),u||(s=o=null)};return function(){var t=p.now();c||!1!==r.leading||(c=t);var e=i-(t-c);return s=this,o=arguments,e<=0||i<e?(u&&(clearTimeout(u),u=null),c=t,a=n.apply(s,o),u||(s=o=null)):u||!1===r.trailing||(u=setTimeout(h,e)),a}},p.debounce=function(e,n,i){var r,s,o,a,u,c=function(){var t=p.now()-a;t<n&&0<=t?r=setTimeout(c,n-t):(r=null,i||(u=e.apply(o,s),r||(o=s=null)))};return function(){o=this,s=arguments,a=p.now();var t=i&&!r;return r||(r=setTimeout(c,n)),t&&(u=e.apply(o,s),o=s=null),u}},p.wrap=function(t,e){return p.partial(e,t)},p.negate=function(t){return function(){return!t.apply(this,arguments)}},p.compose=function(){var n=arguments,i=n.length-1;return function(){for(var t=i,e=n[i].apply(this,arguments);t--;)e=n[t].call(this,e);return e}},p.after=function(t,e){return function(){if(--t<1)return e.apply(this,arguments)}},p.before=function(t,e){var n;return function(){return 0<--t&&(n=e.apply(this,arguments)),t<=1&&(e=null),n}},p.once=p.partial(p.before,2);var k=!{toString:null}.propertyIsEnumerable("toString"),j=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];function F(t,e){var n=j.length,i=t.constructor,r=p.isFunction(i)&&i.prototype||o,s="constructor";for(p.has(t,s)&&!p.contains(e,s)&&e.push(s);n--;)(s=j[n])in t&&t[s]!==r[s]&&!p.contains(e,s)&&e.push(s)}p.keys=function(t){if(!p.isObject(t))return[];if(c)return c(t);var e=[];for(var n in t)p.has(t,n)&&e.push(n);return k&&F(t,e),e},p.allKeys=function(t){if(!p.isObject(t))return[];var e=[];for(var n in t)e.push(n);return k&&F(t,e),e},p.values=function(t){for(var e=p.keys(t),n=e.length,i=Array(n),r=0;r<n;r++)i[r]=t[e[r]];return i},p.mapObject=function(t,e,n){e=_(e,n);for(var i,r=p.keys(t),s=r.length,o={},a=0;a<s;a++)o[i=r[a]]=e(t[i],i,t);return o},p.pairs=function(t){for(var e=p.keys(t),n=e.length,i=Array(n),r=0;r<n;r++)i[r]=[e[r],t[e[r]]];return i},p.invert=function(t){for(var e={},n=p.keys(t),i=0,r=n.length;i<r;i++)e[t[n[i]]]=n[i];return e},p.functions=p.methods=function(t){var e=[];for(var n in t)p.isFunction(t[n])&&e.push(n);return e.sort()},p.extend=y(p.allKeys),p.extendOwn=p.assign=y(p.keys),p.findKey=function(t,e,n){e=_(e,n);for(var i,r=p.keys(t),s=0,o=r.length;s<o;s++)if(e(t[i=r[s]],i,t))return i},p.pick=function(t,e,n){var i,r,s={},o=t;if(null==o)return s;p.isFunction(e)?(r=p.allKeys(o),i=v(e,n)):(r=A(arguments,!1,!1,1),i=function(t,e,n){return e in n},o=Object(o));for(var a=0,u=r.length;a<u;a++){var c=r[a],h=o[c];i(h,c,o)&&(s[c]=h)}return s},p.omit=function(t,e,n){if(p.isFunction(e))e=p.negate(e);else{var i=p.map(A(arguments,!1,!1,1),String);e=function(t,e){return!p.contains(i,e)}}return p.pick(t,e,n)},p.defaults=y(p.allKeys,!0),p.create=function(t,e){var n=m(t);return e&&p.extendOwn(n,e),n},p.clone=function(t){return p.isObject(t)?p.isArray(t)?t.slice():p.extend({},t):t},p.tap=function(t,e){return e(t),t},p.isMatch=function(t,e){var n=p.keys(e),i=n.length;if(null==t)return!i;for(var r=Object(t),s=0;s<i;s++){var o=n[s];if(e[o]!==r[o]||!(o in r))return!1}return!0};var E=function(t,e,n,i){if(t===e)return 0!==t||1/t==1/e;if(null==t||null==e)return t===e;t instanceof p&&(t=t._wrapped),e instanceof p&&(e=e._wrapped);var r=l.call(t);if(r!==l.call(e))return!1;switch(r){case"[object RegExp]":case"[object String]":return""+t==""+e;case"[object Number]":return+t!=+t?+e!=+e:0==+t?1/+t==1/e:+t==+e;case"[object Date]":case"[object Boolean]":return+t==+e}var s="[object Array]"===r;if(!s){if("object"!=typeof t||"object"!=typeof e)return!1;var o=t.constructor,a=e.constructor;if(o!==a&&!(p.isFunction(o)&&o instanceof o&&p.isFunction(a)&&a instanceof a)&&"constructor"in t&&"constructor"in e)return!1}i=i||[];for(var u=(n=n||[]).length;u--;)if(n[u]===t)return i[u]===e;if(n.push(t),i.push(e),s){if((u=t.length)!==e.length)return!1;for(;u--;)if(!E(t[u],e[u],n,i))return!1}else{var c,h=p.keys(t);if(u=h.length,p.keys(e).length!==u)return!1;for(;u--;)if(c=h[u],!p.has(e,c)||!E(t[c],e[c],n,i))return!1}return n.pop(),i.pop(),!0};p.isEqual=function(t,e){return E(t,e)},p.isEmpty=function(t){return null==t||(x(t)&&(p.isArray(t)||p.isString(t)||p.isArguments(t))?0===t.length:0===p.keys(t).length)},p.isElement=function(t){return!(!t||1!==t.nodeType)},p.isArray=a||function(t){return"[object Array]"===l.call(t)},p.isObject=function(t){var e=typeof t;return"function"===e||"object"===e&&!!t},p.each(["Arguments","Function","String","Number","Date","RegExp","Error"],function(e){p["is"+e]=function(t){return l.call(t)==="[object "+e+"]"}}),p.isArguments(arguments)||(p.isArguments=function(t){return p.has(t,"callee")}),"function"!=typeof/./&&"object"!=typeof Int8Array&&(p.isFunction=function(t){return"function"==typeof t||!1}),p.isFinite=function(t){return isFinite(t)&&!isNaN(parseFloat(t))},p.isNaN=function(t){return p.isNumber(t)&&t!==+t},p.isBoolean=function(t){return!0===t||!1===t||"[object Boolean]"===l.call(t)},p.isNull=function(t){return null===t},p.isUndefined=function(t){return void 0===t},p.has=function(t,e){return null!=t&&s.call(t,e)},p.noConflict=function(){return t._=e,this},p.identity=function(t){return t},p.constant=function(t){return function(){return t}},p.noop=function(){},p.property=g,p.propertyOf=function(e){return null==e?function(){}:function(t){return e[t]}},p.matcher=p.matches=function(e){return e=p.extendOwn({},e),function(t){return p.isMatch(t,e)}},p.times=function(t,e,n){var i=Array(Math.max(0,t));e=v(e,n,1);for(var r=0;r<t;r++)i[r]=e(r);return i},p.random=function(t,e){return null==e&&(e=t,t=0),t+Math.floor(Math.random()*(e-t+1))},p.now=Date.now||function(){return(new Date).getTime()};var M={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},U=p.invert(M),R=function(e){var n=function(t){return e[t]},t="(?:"+p.keys(e).join("|")+")",i=RegExp(t),r=RegExp(t,"g");return function(t){return t=null==t?"":""+t,i.test(t)?t.replace(r,n):t}};p.escape=R(M),p.unescape=R(U),p.result=function(t,e,n){var i=null==t?void 0:t[e];return void 0===i&&(i=n),p.isFunction(i)?i.call(t):i};var C=0;p.uniqueId=function(t){var e=++C+"";return t?t+e:e},p.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var D=/(.)^/,I={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},L=/\\|'|\r|\n|\u2028|\u2029/g,B=function(t){return"\\"+I[t]};p.template=function(s,t,e){!t&&e&&(t=e),t=p.defaults({},t,p.templateSettings);var n=RegExp([(t.escape||D).source,(t.interpolate||D).source,(t.evaluate||D).source].join("|")+"|$","g"),o=0,a="__p+='";s.replace(n,function(t,e,n,i,r){return a+=s.slice(o,r).replace(L,B),o=r+t.length,e?a+="'+\n((__t=("+e+"))==null?'':_.escape(__t))+\n'":n?a+="'+\n((__t=("+n+"))==null?'':__t)+\n'":i&&(a+="';\n"+i+"\n__p+='"),t}),a+="';\n",t.variable||(a="with(obj||{}){\n"+a+"}\n"),a="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+a+"return __p;\n";try{var i=new Function(t.variable||"obj","_",a)}catch(t){throw t.source=a,t}var r=function(t){return i.call(this,t,p)},u=t.variable||"obj";return r.source="function("+u+"){\n"+a+"}",r},p.chain=function(t){var e=p(t);return e._chain=!0,e};var H=function(t,e){return t._chain?p(e).chain():e};p.mixin=function(n){p.each(p.functions(n),function(t){var e=p[t]=n[t];p.prototype[t]=function(){var t=[this._wrapped];return r.apply(t,arguments),H(this,e.apply(p,t))}})},p.mixin(p),p.each(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var n=i[e];p.prototype[e]=function(){var t=this._wrapped;return n.apply(t,arguments),"shift"!==e&&"splice"!==e||0!==t.length||delete t[0],H(this,t)}}),p.each(["concat","join","slice"],function(t){var e=i[t];p.prototype[t]=function(){return H(this,e.apply(this._wrapped,arguments))}}),p.prototype.value=function(){return this._wrapped},p.prototype.valueOf=p.prototype.toJSON=p.prototype.value,p.prototype.toString=function(){return""+this._wrapped},"function"==typeof define&&define.amd&&define("underscore",[],function(){return p})}).call(this)},{}],4:[function(t,e,n){for(var r=[],i=0;i<256;++i)r[i]=(i+256).toString(16).substr(1);e.exports=function(t,e){var n=e||0,i=r;return i[t[n++]]+i[t[n++]]+i[t[n++]]+i[t[n++]]+"-"+i[t[n++]]+i[t[n++]]+"-"+i[t[n++]]+i[t[n++]]+"-"+i[t[n++]]+i[t[n++]]+"-"+i[t[n++]]+i[t[n++]]+i[t[n++]]+i[t[n++]]+i[t[n++]]+i[t[n++]]}},{}],5:[function(t,e,n){var i="undefined"!=typeof crypto&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&msCrypto.getRandomValues.bind(msCrypto);if(i){var r=new Uint8Array(16);e.exports=function(){return i(r),r}}else{var s=new Array(16);e.exports=function(){for(var t,e=0;e<16;e++)0==(3&e)&&(t=4294967296*Math.random()),s[e]=t>>>((3&e)<<3)&255;return s}}},{}],6:[function(t,e,n){var o=t("./lib/rng"),a=t("./lib/bytesToUuid");e.exports=function(t,e,n){var i=e&&n||0;"string"==typeof t&&(e="binary"===t?new Array(16):null,t=null);var r=(t=t||{}).random||(t.rng||o)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,e)for(var s=0;s<16;++s)e[i+s]=r[s];return e||a(r)}},{"./lib/bytesToUuid":4,"./lib/rng":5}],7:[function(i,t,e){"use strict";var r=i("underscore"),n=i("./elem"),s=(i("./region"),i("./logger")),o=(i("./util"),function(t){n.call(this,t),this._type="state",this.container=null,this.region=null,this.children=[],this.setObserverType("container")});o.prototype=r.create(n.prototype,{constructor:o,_cname:"ProtoState",getRegion:function(t){return r.isNumber(t)?this.children[t]:this.region},getRoot:function(){for(var t=this;!r.isNull(t._getParentState());)t=t._getParentState();return t},getRegionByName:function(e){return r.find(this.children,function(t){return t._name===e})},getRegionById:function(e){return r.find(this.children,function(t){return t._id===e})},completion:function(){this.isActive()||s.error(this._cname+'インスタンス"'+this._name+'"はすでに非アクティブ化されています。'),this._async(function(){this._exit(),r.isNull(this.container)||this.notify("container","completion")})},_getParentState:function(){var t=null;return r.isNull(this.container)||r.isNull(this.container.parent)||(t=this.container.parent),t},_hasSubState:function(){return r.some(this.children,function(t){return 0<t.children.states.length})},update:function(t){var e=r.toArray(arguments).slice(1);switch(t){case"entry":this._entry.apply(this,e);break;case"exit":this._exit.apply(this,e);break;case"refresh":this._refresh.apply(this,e);break;case"completion":this.completion.apply(this,e)}},_refresh:function(t){this._depth=t,this.parent=this._getParentState(),this.notify("children","refresh",t)},_entry:function(t){this.isActive()||(this._activate(),this.notify("children","entry",t))},_exit:function(){this.isActive()&&(this.notify("children","exit"),this._deactivate())},addState:function(){var t=r.toArray(arguments);return r.isNull(this.region)&&this.appendRegion(),this.region.addState.apply(this.region,t)},removeState:function(){var t=r.toArray(arguments);return r.isNull(this.region)&&s.error("デフォルトのRegionインスタンスが存在しません。"),this.region.removeState.apply(this.region,t)},addTransition:function(){var t=r.toArray(arguments);return r.isNull(this.region)&&this.appendRegion(),this.region.addTransition.apply(this.region,t)},removeTransition:function(){var t=r.toArray(arguments);return r.isNull(this.region)&&s.error("デフォルトのRegionインスタンスが存在しません。"),this.region.removeTransition.apply(this.region,t)},appendRegion:function(t){var e=i("./region");return this._attached&&s.error("デプロイ後は要素の追加/削除はできません。Machineクラスのundeploy()メソッドでデプロイを取り消してください。"),r.isNull(this.region)?(r.isUndefined(t)?(t=new e("default-region-of-"+this._name),s.info(this._cname+'インスタンス"'+this._name+'"のRegionインスタンスが自動作成されました。')):t instanceof e||s.error("Regionインスタンスを指定してください。"),this.region=t):r.isUndefined(t)?t=new e(!1):t instanceof e||s.error("Regionインスタンスを指定してください。"),(t.parent=this).children.push(t),this.addObserver("children",t),t.addObserver("parent",this),t._originalName||(t._name="region-index-"+t.getIndex()+"-of-"+this._name,t._setDefaultStateName()),t._refresh(this._depth),t},removeRegion:function(t){var e,n;return e=i("./region"),this._attached&&s.error("デプロイ後は要素の追加/削除はできません。Machineクラスのundeploy()メソッドでデプロイを取り消してください。"),t instanceof e||s.error("Regionインスタンスを指定してください。"),-1<(n=r.indexOf(this.children,t))?this.children.splice(n,1):s.error("削除対象のRegionインスタンスが見つかりません。"),t.parent=null,this.region===t&&(this.region=null),t._refresh(),this.removeObserver("children",t),t.removeObserver("parent",this),t._originalName||(t._name=this._id,t._setDefaultStateName()),t}}),t.exports=o},{"./elem":8,"./logger":10,"./region":16,"./util":20,underscore:3}],8:[function(t,e,n){"use strict";var i=t("es6-promise").Promise,r=t("underscore"),s=t("./entity"),o=(t("./logger"),t("./util"),t("./mixin")),a=function(t){s.call(this,t),this._type="element",this.parent=null,this.children=null,this._attached=!1,this._depth=0,this.setObserverType("root","parent","children"),Object.defineProperties(this,o.descriptor)};a.prototype=r.create(s.prototype,r.extend({constructor:a,_cname:"Elem",getCurrentDepth:function(){return this._depth},_async:function(t){t=r.bind(t,this),this.notify("root","async",function(){return t(),i.resolve()})},_entry:function(){this.isActive()||(this._activate(),this.notify("children","entry"))},_exit:function(){this.isActive()&&(this.notify("children","exit"),this._deactivate())}},o.helper)),e.exports=a},{"./entity":9,"./logger":10,"./mixin":12,"./util":20,"es6-promise":1,underscore:3}],9:[function(t,e,n){"use strict";var i=t("uuid/v4"),r=t("underscore"),s=t("./subject"),o=t("./model"),a=t("./logger"),u=t("./util"),c=t("./mixin"),h=function(t){s.call(this),this._id=i(),u.isFalsy(t)?(this._name=this._id,this._originalName=!1):this._name=this._originalName=t,this._type="entity",this._status="inactive",this.model=new o};h.prototype=r.create(s.prototype,r.extend({constructor:h,_cname:"Entity",getId:function(){return this._id},getName:function(){return this._name},setName:function(t){return this._name=t,this._originalName||(this._originalName=t),t},isActive:function(){return"active"===this._status},_activate:function(){this.isActive()||(this._status="active",a.info(this._cname+'インスタンス"'+this._name+'"がアクティブ化されました。'))},_deactivate:function(){this.isActive()&&(this._status="inactive",a.info(this._cname+'インスタンス"'+this._name+'"が非アクティブ化されました。'))},update:r.noop},c.accessor)),e.exports=h},{"./logger":10,"./mixin":12,"./model":13,"./subject":18,"./util":20,underscore:3,"uuid/v4":6}],10:[function(t,e,n){"use strict";var i=t("underscore"),r={config:{logLevel:"DEBUG",debuggable:!0},logLevelData:["DEBUG","INFO","WARN","ERROR"],enable:function(){this.config.debuggable||(this.config.debuggable=!0)},disable:function(){this.config.debuggable&&(this.config.debuggable=!1)},setLogLevel:function(t){t=t.toUpperCase(),-1!==i.indexOf(this.logLevelData,t)&&(this.config.logLevel=t)},debug:function(t){this.config.debuggable&&i.indexOf(this.logLevelData,this.config.logLevel)<=0&&console.log("DEBUG: ",t)},info:function(t){this.config.debuggable&&i.indexOf(this.logLevelData,this.config.logLevel)<=1&&console.log("INFO: ",t)},warn:function(t){this.config.debuggable&&i.indexOf(this.logLevelData,this.config.logLevel)<=2&&console.log("WARN: ",t)},error:function(t){if(this.config.debuggable&&i.indexOf(this.logLevelData,this.config.logLevel)<=3)throw console.error("ERROR: ",t),new Error("ERROR: "+t)}};e.exports=r},{underscore:3}],11:[function(t,e,n){"use strict";var i=t("es6-promise").Promise,s=t("underscore"),o=t("./base-state"),a=t("./logger"),u=t("./util"),r=function(t,e){o.call(this,t,e),e=e||{},s.isObject(e.data)&&!s.isFunction(e.data)&&this.set(e.data),this.save(),s.isObject(e.props)&&!s.isFunction(e.props)&&this.addProp(e.props),s.isObject(e.methods)&&!s.isFunction(e.methods)&&this.addMethod(e.methods),this._deployed=!1,this._chain={main:null,activities:[],counter:0},this.appendRegion(),this.setObserverType("outer-machine")};r.prototype=s.create(o.prototype,{constructor:r,_cname:"Machine",deploy:function(){var e,n;return e=t("./transition"),n=t("./pseudo-states").ConnectionPointPseudoState,this._deployed=!0,this._chain.main=i.resolve(),this._refresh(this._depth),u.eachElem(this,s.bind(function(t){t._attached=!0,t instanceof r||(t.addObserver("root",this),(t instanceof o||t instanceof e)&&t.addObserver("parent",t.parent)),t instanceof n&&t.parent===this&&(t._isConnector=!0)},this)),this},undeploy:function(){var e=t("./transition");return this._deployed=!1,this._chain.main=null,u.eachElem(this,s.bind(function(t){t._attached=!1,t instanceof r||(t.removeObserver("root",this),(t instanceof o||t instanceof e)&&t.removeObserver("parent",t.parent))},this)),this._refresh(this._depth),this},start:function(t){var e={priority:null,deepHistory:!1};return s.isUndefined(t)||(e.priority=t),this._deployed||a.error("start()の前にdeploy()メソッドを実行してください。"),this.isActive()?a.warn('Machineインスタンス"'+this._name+'"はすでに起動しています。'):(a.info('Machineインスタンス"'+this._name+'"が動作を開始しました。'),this._addChain(s.bind(function(){return this._entry(e),i.resolve()},this))),this},finish:function(){return this._deployed||a.error("deploy()メソッドがまだ実行されていません。"),this.isActive()?this.completion():a.warn('Machineインスタンス"'+this._name+'"はすでに動作を終了しています。'),this},completion:function(){this.isActive()||a.error(this._cname+'インスタンス"'+this._name+'"はすでに非アクティブ化されています。'),this._addChain(s.bind(function(){return this._exit(),a.info('Machineインスタンス"'+this._name+'"が動作を終了しました。'),i.resolve()},this))},_addChain:function(t){this._chain.main=this._chain.main.then(t).catch(this._onRejected)},_addActivity:function(t){this._chain.activities.push(t)},_prevActivity:function(t){s.isNull(this._chain.resolve)&&(this._chain.counter+=t.children.length)},_afterActivity:function(t){var n=this;t._hasSubState()||(this._chain.counter-=1,this._chain.counter<=0&&(this._chain.main=s.reduce(this._chain.activities,function(t,e){return t.then(e).catch(n._onRejected)},this._chain.main),this._chain.activities.length=0,this._chain.counter=0))},_onAborted:function(t){a.info('Machineインスタンス"'+this._name+'"は処理を停止しました。')},_onRejected:function(t){return a.info(t),i.reject(t)},_inboundTransit:function(t){var e,n,i;if(s.isUndefined(t))this.start();else{for(s.isEmpty(t)&&a.error("リンク先のEntryPointPseudoStateインスタンスに対応するキーが指定されてません。"),e=0,n=this.children.length;e<n;e+=1)if(i=this.children[e].children.states[t],!s.isUndefined(i))return void this.start(i);a.error("エンドポイントのEntryPointPseudoStateインスタンスが指定されてません。")}},_outboundTransit:function(t){this.completion(),this._addChain(s.bind(function(){return this.notify("outer-machine","link-back",t._id),i.resolve()},this))},update:function(t,e){var n=s.toArray(arguments).slice(1);switch(t){case"async":this._addChain(e);break;case"async-activity":this._addActivity(e);break;case"prev-activity":this._prevActivity.apply(this,n);break;case"after-activity":this._afterActivity.apply(this,n);break;case"entry":this._entry.apply(this,n);break;case"exit":this._exit.apply(this,n);break;case"completion":this.completion.apply(this,n);break;case"termination":this._onAborted.apply(this,n);break;case"link-forward":this._inboundTransit.apply(this,n);break;case"exit-point":this._outboundTransit.apply(this,n)}}});var c=function(t){o.call(this,t),this._link=null,this._deployed=!1,this.appendRegion(),this.setObserverType("inner-machine")};c.prototype=s.create(o.prototype,{constructor:c,_cname:"SubMachine",deploy:function(){var e,n,i,r;return e=t("./pseudo-states").PseudoState,n=t("./pseudo-states").ConnectionPointPseudoState,i=t("./pseudo-states").InitialPseudoState,r=t("./states").FinalState,this._deployed=!0,u.eachElem(this,s.bind(function(t){t instanceof o&&(t instanceof e?t instanceof n?(t.addObserver("sub-root",this),t.parent===this?t._isMediator=!0:a.error("ConnectionPointPseudoStateインスタンスはサブマシン直下のサブ状態でなければなりません。")):t instanceof i||a.error("SubMachineインスタンスはConnectionPointPseudoStateクラス以外の状態を追加できません。"):t instanceof c||t instanceof r||a.error("SubMachineインスタンスはConnectionPointPseudoStateクラス以外の状態を保持できません。"))},this)),this},undeploy:function(){var e,n,i,r;return e=t("./pseudo-states").PseudoState,n=t("./pseudo-states").ConnectionPointPseudoState,i=t("./pseudo-states").InitialPseudoState,r=t("./states").FinalState,this._deployed=!1,u.eachElem(this,s.bind(function(t){t instanceof o&&(t instanceof e?t instanceof n?(t.removeObserver("sub-root",this),t._isMediator=!1):t instanceof i||a.error("SubMachineインスタンスはConnectionPointPseudoStateクラス以外の状態を追加できません。"):t instanceof c||t instanceof r||a.error("SubMachineインスタンスはConnectionPointPseudoStateクラス以外の状態を保持できません。"))},this)),this},addLink:function(t){t instanceof r||a.error("Machineインスタンスを指定してください。"),this._link=t,this.addObserver("inner-machine",t),t.addObserver("outer-machine",this)},removeLink:function(){this.removeObserver("inner-machine",this._link),this._link.removeObserver("outer-machine",this),this._link=null},update:function(t){var e=s.toArray(arguments).slice(1);switch(t){case"entry-point":this._linkForward.apply(this,e);break;case"link-back":this._linkBack.apply(this,e);break;case"entry":this._entry.apply(this,e);break;case"exit":this._exit.apply(this,e)}},_linkForward:function(t){this._async(function(){t._exit(),this.notify("inner-machine","link-forward",t._key)})},_linkBack:function(t){var e,n,i,r;for(n=0,i=this.children.length;n<i;n+=1)if(r=this.children[n],e=s.findWhere(r.children.states,{_key:t}),!s.isUndefined(e))return void e._entry();a.error("リンク先のEntryPointPseudoStateインスタンスに対応するキーが指定されてません。")},_entry:function(t){this._deployed||a.error("SubMachineインスタンスのdeploy()メソッドを実行してください。"),this.isActive()||(this._activate(),this.notify("children","entry",t))},_exit:function(){this._deployed||a.error("SubMachineインスタンスのdeploy()メソッドを実行してください。"),this.isActive()&&(this.notify("children","exit"),this._deactivate())}}),e.exports={Machine:r,SubMachine:c}},{"./base-state":7,"./logger":10,"./pseudo-states":15,"./states":17,"./transition":19,"./util":20,"es6-promise":1,underscore:3}],12:[function(t,e,n){"use strict";var o=t("underscore"),i=t("./logger"),r={accessor:{has:function(t){return this.model.has(t)},get:function(t){return this.model.get(t)},set:function(t,e){return this.model.set(t,e)},unset:function(t){return this.model.unset(t)},extend:function(t){return this.model.extend(t)},save:function(){this.model.save()},restore:function(){this.model.restore()},clear:function(){this.model.clear()},addProp:function(t){this.model.addProp(t)},addMethod:function(t,e){e=o.isUndefined(e)?this:e,this.model.addMethod(t,e)},watch:function(t,e){this.model.watch(t,e)},unwatch:function(t,e){this.model.unwatch(t,e)}},helper:{$has:function(t){return function t(e,n){var i,r;i=n.has(e);i||("region"===n._type?(r=n.parent,o.isNull(r)||(i=t(e,r))):o.isNull(n.container)||(i=t(e,n.container)));return i}(t,this)},$get:function(t){return function t(e,n){var i,r;i=n.get(e);o.isUndefined(i)&&("region"===n._type?(r=n.parent,o.isNull(r)||(i=t(e,r))):o.isNull(n.container)||(i=t(e,n.container)));return i}(t,this)},$set:function(t,e){return function t(e,n,i){var r,s;r=i.get(e);o.isUndefined(r)?"region"===i._type?(s=i.parent,o.isNull(s)||(r=t(e,n,s))):o.isNull(i.container)||(r=t(e,n,i.container)):r=i.set(e,n);return r}(t,e,this)},$unset:function(t){return function t(e,n){var i,r;i=n.get(e);o.isUndefined(i)?"region"===n._type?(r=n.parent,o.isNull(r)||(i=t(e,r))):o.isNull(n.container)||(i=t(e,n.container)):i=n.unset(e);return i}(t,this)},$getProp:function(t){return function t(e,n){var i,r;i=n.props[e];o.isUndefined(i)&&("region"===n._type?(r=n.parent,o.isNull(r)||(i=t(e,r))):o.isNull(n.container)||(i=t(e,n.container)));return i}(t,this)},$getMethod:function(t){return function t(e,n){var i,r;i=n.methods[e];o.isUndefined(i)&&("region"===n._type?(r=n.parent,o.isNull(r)||(i=t(e,r))):o.isNull(n.container)||(i=t(e,n.container)));return i}(t,this)}},disable:{has:function(){i.error(this._cname+"インスタンスは内部データを保持できません。")},get:function(){i.error(this._cname+"インスタンスは内部データを保持できません。")},set:function(){i.error(this._cname+"インスタンスは内部データを保持できません。")},unset:function(){i.error(this._cname+"インスタンスは内部データを保持できません。")},extend:function(t){i.error(this._cname+"インスタンスは内部データを保持できません。")},save:function(){i.error(this._cname+"インスタンスは内部データを保持できません。")},restore:function(){i.error(this._cname+"インスタンスは内部データを保持できません。")},clear:function(){i.error(this._cname+"インスタンスは内部データを保持できません。")},addProp:function(t){i.error(this._cname+"インスタンスは内部データを保持できません。")},addMethod:function(t){i.error(this._cname+"インスタンスは内部データを保持できません。")},watch:function(t,e){i.error(this._cname+"インスタンスは内部データを保持できません。")},unwatch:function(t,e){i.error(this._cname+"インスタンスは内部データを保持できません。")},$getProp:function(t,e){i.error(this._cname+"インスタンスは内部データを保持できません。")},$getMethod:function(t,e){i.error(this._cname+"インスタンスは内部データを保持できません。")},$has:function(){i.error(this._cname+"インスタンスは内部データを保持できません。")},$get:function(){i.error(this._cname+"インスタンスは内部データを保持できません。")},$set:function(){i.error(this._cname+"インスタンスは内部データを保持できません。")},$unset:function(){i.error(this._cname+"インスタンスは内部データを保持できません。")},addState:function(){i.error(this._cname+"インスタンスはサブ状態を持てません。")},removeState:function(){i.error(this._cname+"インスタンスはサブ状態を持てません。")},addTransition:function(){i.error(this._cname+"インスタンスは遷移を持てません。")},removeTransition:function(){i.error(this._cname+"インスタンスは遷移を持てません。")},appendRegion:function(){i.error(this._cname+"インスタンスは領域を持てません。")},removeRegion:function(){i.error(this._cname+"インスタンスは領域を持てません。")}},descriptor:{props:{enumerable:!1,get:function(){return this.model.props}},methods:{enumerable:!1,get:function(){return this.model.methods}}}};e.exports=r},{"./logger":10,underscore:3}],13:[function(t,e,n){"use strict";var o=t("underscore"),i=t("./observable"),s=t("./logger"),a="/",r=function(t){i.call(this),this._data=this._savedData=null,this.props={},this.methods={},this._cache={},o.isObject(t)&&!o.isFunction(t)&&this.set(t)};function u(n,t){return n=n||(o.isArray(t)?[]:{}),o.each(t,function(t,e){o.isObject(t)&&!o.isFunction(t)?(n[e]=o.isArray(t)?[]:{},u(n[e],t)):n[e]=t}),n}function c(t,e){var n=!1;switch(e){case"json":o.isString(t)||o.isNumber(t)||o.isBoolean(t)||o.isNull(t)?n=!0:o.isArray(t)||o.isObject(t)&&!o.isFunction(t)?n=o.every(t,function(t){return c(t,e)}):s.error("JSONデータ型以外はデータに登録できません。");break;case"function":o.isFunction(t)?n=!0:o.isArray(t)||o.isObject(t)&&!o.isFunction(t)?n=o.every(t,function(t){return c(t,e)}):s.error("Function以外はメソッドに登録できません。");break;case"not-function":o.isFunction(t)?o.isArray(t)||o.isObject(t)&&!o.isFunction(t)?n=o.every(t,function(t){return c(t,e)}):s.error("Functionはプロパティに登録できません。"):n=!0}return n}function h(t){return o.compact(t.split(a))}function l(t,e){return o.every(t,function(t){if((o.isArray(e)||o.isObject(e)&&!o.isFunction(e))&&e.hasOwnProperty(t))return e=e[t],!0})}function f(t,e){return o.reduce(t,function(t,e){return t[e]},e)}function d(t){return o.isString(t)||s.error("クエリは文字列で指定してください。"),t!==a&&(t=t.replace(/^\/|\/$/g,"")),t}r.prototype=o.create(i.prototype,{constructor:r,_cname:"Model",has:function(t){return!o.isUndefined(this.get(t))},get:function(t){return t=d(t),this._test("_get",t)},set:function(t,e){var n,i;return o.isUndefined(e)&&(e=t,t=a),t=d(t),n=this._test("_get",t),o.isEqual(n,e)||(c(e,"json"),this._set(t,e),i=null==n?"create":"update",this._bubbling(i,t,e,n)),e},unset:function(t){var e;if(t=d(t),e=this._test("_get",t),!o.isUndefined(e))return this._unset(t),this._bubbling("delete",t,e),e},save:function(){this._savedData=u(this._savedData,this._data)},restore:function(){o.isNull(this._savedData)||(this._data=u(null,this._savedData))},clear:function(){this._data=this._savedData=null},addProp:function(t){c(t,"not-function"),this.props=u(this.props,t)},addMethod:function(t,e){c(t,"function"),function i(r,t,s){o.each(t,function(t,e){var n;o.isFunction(t)?(n=o.bind(t,s),r[e]=n):(r[e]={},i(r[e],t,s))})}(this.methods,t,e)},_test:function(t,e){var n;try{n=this[t](e)}catch(t){}return n},_get:function(t){return f(h(t),this._data)},_set:function(t,e){var n,i,r;return l(n=h(t),this._data)||s.error("クエリに対応するデータ構造が存在しません。"),n.length?(i=n.pop(),r=f(n,this._data),o.isObject(e)&&!o.isFunction(e)?(r[i]={},u(r[i],e)):r[i]=e):this._data=u(this._data,e),e},_unset:function(t){var e,n,i,r;return n=(e=h(t)).pop(),l(e,this._data)||s.error("クエリに対応するデータ構造が存在しません。"),r=(i=f(e,this._data))[n],delete i[n],r},_bubbling:function(t,e,n,i){var r,s,o;for(r=h(e),o={event:t,currentTarget:"",target:e,value:n,oldValue:i};r.length;)s=r.join(a),o.currentTarget=s,0<this.countListeners(s)&&this.notifyListeners(s,o),r.pop();o.currentTarget=a,0<this.countListeners(a)&&this.notifyListeners(a,o)},watch:function(t,e){o.isFunction(t)&&(e=t,t=a),t=d(t),this.observe(t,e)},unwatch:function(t,e){o.isFunction(t)&&(e=t,t=a),t=d(t),this.unobserve(t,e)}}),e.exports=r},{"./logger":10,"./observable":14,underscore:3}],14:[function(t,e,n){"use strict";var o=t("underscore"),i=function(){this._listeners={}};i.prototype=o.create(Object.prototype,{constructor:i,_cname:"Observable",hasListener:function(t,e){var n=!1;return o.isUndefined(this._listeners[t])||-1<o.indexOf(this._listeners[t],e)&&(n=!0),n},countListeners:function(t){var e=0;return o.isUndefined(this._listeners[t])||(e=this._listeners[t].length),e},observe:function(t,e){o.isUndefined(this._listeners[t])&&(this._listeners[t]=[]),o.isFunction(e)&&this._listeners[t].push(e)},unobserve:function(t,e){var n,i;n=this._listeners[t],o.isUndefined(n)||-1<(i=o.indexOf(n,e))&&n.splice(i,1)},notifyListeners:function(t,e){var n,i,r,s;if(n=this._listeners[t],!o.isUndefined(n))for(i=0,r=n.length;i<r;i+=1)s=n[i],o.isFunction(s)&&(e=o.isArray(e)?e:o.toArray(arguments).slice(1),s.apply(null,e))}}),e.exports=i},{underscore:3}],15:[function(t,e,n){"use strict";var i=t("underscore"),r=t("./base-state"),s=t("./logger"),o=t("./util"),a=t("./mixin"),u=function(t){r.call(this,t),this._type="pseudo-state"};u.prototype=i.create(r.prototype,i.extend({constructor:u,_cname:"PseudoState",_deactivate:function(){this._status="inactive",i.isNull(this.container)||this.notify("container","set-previous-state",null),s.info(this._cname+'インスタンス"'+this._name+'"が非アクティブ化されました。')}},a.disable));var c=function(t){u.call(this,t)};c.prototype=i.create(u.prototype,{constructor:c,_cname:"InitialPseudoState",_activate:function(){var t;this._status="active",s.info('InitialPseudoStateインスタンス"'+this._name+'"がアクティブ化されました。'),i.isNull(this.container)||(t=o.findFirstTransition(this.container),i.isUndefined(t)?s.error('Regionインスタンス"'+this.container._name+'"の初期遷移が見つかりません。'):t.trigger())}});var h=function(t,e){u.call(this,t),this._isDeep=!i.isUndefined(e)&&e};h.prototype=i.create(u.prototype,{constructor:h,_cname:"HistoryPseudoState",_activate:function(){var t,e;this._status="active",s.info('HistoryPseudoStateインスタンス"'+this._name+'"がアクティブ化されました。'),i.isNull(this.container)||(t=this.container,(e=t._previousState||t._initialPseudo)instanceof c?this._async(function(){this._exit(),e.update("entry")}):this._async(function(){this._exit(),e.update("entry",{priority:null,deepHistory:this._isDeep})}))}});var l=function(t){u.call(this,t)};l.prototype=i.create(u.prototype,{constructor:l,_cname:"TerminatePseudoState",_activate:function(){this._status="active",s.info('TerminatePseudoStateインスタンス"'+this._name+'"がアクティブ化されました。'),this.notify("root","termination",this),s.error("停止状態に遷移しました。処理を中断します。")}});var f=function(t,e){u.call(this,t),this._condition=i.isFunction(e)?e:i.noop};f.prototype=i.create(u.prototype,{constructor:f,_cname:"ChoicePseudoState",_activate:function(){var t,e;e=o.findRelatedTransition(this),this._status="active",s.info('ChoicePseudoStateインスタンス"'+this._name+'"がアクティブ化されました。'),(t=this._condition(e))instanceof r||s.error("遷移先のStateインスタンスが存在しません。"),i.isNull(this.container)||(e=o.findNextTransition(this.container,this,t),i.isUndefined(e)?s.error('ChoicePseudoStateインスタンス"'+this._name+'"起点のTransitionインスタンスが見つかりません。'):e.trigger())}});var d=function(t){u.call(this,t),this._key="",this._isMediator=!1,this._isConnector=!1,this.setObserverType("sub-root")};d.prototype=i.create(u.prototype,{constructor:d,_cname:"ConnectionPointPseudoState",setKey:function(t){return this._key=t}});var p=function(t){d.call(this,t)};p.prototype=i.create(d.prototype,{constructor:p,_cname:"EntryPointPseudoState",_activate:function(){var t;this._status="active",s.info('EntryPointPseudoStateインスタンス"'+this._name+'"がアクティブ化されました。'),this._isMediator?this.notify("sub-root","entry-point",this):i.isNull(this.container)||(t=o.findFirstTransition(this.container,this),i.isUndefined(t)?s.error('Regionインスタンス"'+this.container._name+'"の初期遷移が見つかりません。'):t.trigger())}});var v=function(t){d.call(this,t)};v.prototype=i.create(d.prototype,{constructor:v,_cname:"ExitPointPseudoState",_activate:function(){var t,e;this._status="active",s.info('ExitPointPseudoStateインスタンス"'+this._name+'"がアクティブ化されました。'),this._isConnector?this.notify("root","exit-point",this):(t=this.container._getUpperContainer(),i.isNull(t)?s.error('ExitPointPseudoStateインスタンス"'+this._name+'"の上位コンテナが存在しません。'):(e=o.findNextTransition(t,this),i.isUndefined(e)?s.error('ExitPointPseudoStateインスタンス"'+this._name+'"起点のTransitionインスタンスが見つかりません。'):e.trigger()))}}),e.exports={PseudoState:u,InitialPseudoState:c,HistoryPseudoState:h,TerminatePseudoState:l,ChoicePseudoState:f,ConnectionPointPseudoState:d,EntryPointPseudoState:p,ExitPointPseudoState:v}},{"./base-state":7,"./logger":10,"./mixin":12,"./util":20,underscore:3}],16:[function(c,t,e){"use strict";var h=c("underscore"),n=c("./elem"),l=c("./logger"),f=c("./util"),i=function(t,e){n.call(this,t),this._type="region",e=e||{},h.isObject(e.data)&&!h.isFunction(e.data)&&this.set(e.data),this.save(),h.isObject(e.props)&&!h.isFunction(e.props)&&this.addProp(e.props),h.isObject(e.methods)&&!h.isFunction(e.methods)&&this.addMethod(e.methods),this._initialPseudo=null,this._final=null,this._historyPseudo=null,this._previousState=null,this.children={states:[],transitions:[]},this.setObserverType("states","transits"),this._setDefaultStates()};i.prototype=h.create(n.prototype,{constructor:i,_cname:"Region",setName:function(t){return this._name=t,this._originalName||(this._originalName=t,this._setDefaultStateName()),t},hasHistory:function(t){return f.isFalsy(t)?!h.isNull(this._historyPseudo):!h.isNull(this._historyPseudo)&&this._historyPseudo._isDeep},getIndex:function(){var t=-1;return h.isNull(this.parent)||(t=h.indexOf(this.parent.children,this)),t},getStateByName:function(e){return h.find(this.children.states,function(t){return t._name===e})},getTransitionByName:function(e){return h.find(this.children.transitions,function(t){return t._name===e})},getStateById:function(e){return h.find(this.children.states,function(t){return t._id===e})},getTransitionById:function(e){return h.find(this.children.transitions,function(t){return t._id===e})},addState:function(){var t,e,n,i,r,s,o,a,u;for(t=c("./base-state"),n=c("./pseudo-states").HistoryPseudoState,e=c("./pseudo-states").InitialPseudoState,i=c("./states").FinalState,this._attached&&l.error("デプロイ後は要素の追加/削除はできません。Machineクラスのundeploy()メソッドでデプロイを取り消してください。"),s=0,o=(r=h.toArray(arguments)).length;s<o;s+=1)(a=r[s])instanceof t||l.error("Stateインスタンスを指定してください。"),a instanceof e?this._initialPseudo=a:a instanceof i?this._final=a:a instanceof n&&(this._historyPseudo=a),this.children.states.push(a),this.children.states[a._id]=a,this.addObserver("children",a),this.addObserver("states",a),a.container=this,a.addObserver("container",this),u=this._getParentDepth()+1,a._refresh(u);return 1<r.length?r:h.first(r)},removeState:function(){var t,e,n,i;for(t=c("./pseudo-states").HistoryPseudoState,this._attached&&l.error("デプロイ後は要素の追加/削除はできません。Machineクラスのundeploy()メソッドでデプロイを取り消してください。"),e=h.toArray(arguments),n=this.children.states.length;n--;)i=this.children.states[n],-1<h.indexOf(e,i)&&(i instanceof t&&(this._historyPseudo=null),this.children.states.splice(n,1),delete this.children.states[i._id],this.removeObserver("children",i),this.removeObserver("states",i),i.container=null,i.removeObserver("container",this),i._refresh(0));return 1<e.length?e:h.first(e)},addTransition:function(){var t,e,n,i,r,s,o,a,u;for(t=c("./pseudo-states").InitialPseudoState,e=c("./states").FinalState,n=c("./transition"),this._attached&&l.error("デプロイ後は要素の追加/削除はできません。Machineクラスのundeploy()メソッドでデプロイを取り消してください。"),r=0,s=(i=h.toArray(arguments)).length;r<s;r+=1)(o=i[r])instanceof n||l.error("Transitionインスタンスを指定してください。"),o._rawSource===t||f.isFalsy(o._rawSource)?o.source=this._initialPseudo:(a=f.findState(this,o._rawSource,0),h.isUndefined(a)&&(a=f.findState(this,o._rawSource,1),h.isUndefined(a)?l.error("遷移元のStateインスタンスが見つかりません。"):o._exitViaExitPoint=!0),o.source=o._rawSource),o._rawTarget===e||f.isFalsy(o._rawTarget)?o.target=this._final:(a=f.findState(this,o._rawTarget,0),h.isUndefined(a)&&(a=f.findState(this,o._rawTarget,1),h.isUndefined(a)?l.error("遷移先のStateインスタンスが見つかりません。"):o._isExplicitEntry=!0),o.target=o._rawTarget),o.addObserver("source",o.source),o.addObserver("target",o.target),o._originalName||(o._name="transit-from-"+o.source._name+"-to-"+o.target._name),this.children.transitions.push(o),this.children.transitions[o._id]=o,this.addObserver("children",o),this.addObserver("transits",o),o.container=this,o.addObserver("container",this),u=this._getParentDepth()+1,o._refresh(u);return 1<i.length?i:h.first(i)},removeTransition:function(){var t,e,n;for(this._attached&&l.error("デプロイ後は要素の追加/削除はできません。Machineクラスのundeploy()メソッドでデプロイを取り消してください。"),t=h.toArray(arguments),e=this.children.transitions.length;e--;)n=this.children.transitions[e],-1<h.indexOf(t,n)&&(this.children.transitions.splice(e,1),delete this.children.transitions[n._id],this.removeObserver("children",n),this.removeObserver("transits",n),n.removeObserver("source",n.source),n.removeObserver("target",n.target),n._originalName||(n._name=n._id),n.container=null,n.removeObserver("container",this),n._refresh(0));return 1<t.length?t:h.first(t)},update:function(t){var e=h.toArray(arguments).slice(1);switch(t){case"entry":this._entry.apply(this,e);break;case"exit":this._exit.apply(this,e);break;case"refresh":this._refresh.apply(this,e);break;case"completion":this._completion.apply(this,e);break;case"set-previous-state":this._setPreviousState.apply(this,e)}},_getParentDepth:function(){var t=-1;return h.isNull(this.parent)||(t=this.parent._depth),t},_getUpperContainer:function(){var t=null;return h.isNull(this.parent)||h.isNull(this.parent.container)||(t=this.parent.container),t},_setDefaultStates:function(){var t,e,n=c("./pseudo-states").InitialPseudoState,i=c("./states").FinalState;t=new n(!1),e=new i(!1),this.addState(t,e),this._setDefaultStateName()},_setDefaultStateName:function(){this._initialPseudo._name="initial-pseudo-state-in-"+this._name,this._final._name="final-state-in-"+this._name},_refresh:function(t){var e;e=(t=h.isUndefined(t)?this._getParentDepth():t)+1,this.notify("children","refresh",e)},_setPreviousState:function(t){return this._previousState=t},_entry:function(t){var e,n,i;if(e=c("./machines").SubMachine,n=c("./pseudo-states").PseudoState,!this.isActive()){if(this._activate(),-1<h.indexOf(this.children.states,t.priority))i=t.priority,t.priority=null;else{if(this.parent instanceof e)return void this.parent.notify("inner-machine","link-forward");t.deepHistory?i=this._previousState||this._initialPseudo:h.isNull(this._historyPseudo)?i=this._initialPseudo:(i=this._historyPseudo)._isDeep&&(t.deepHistory=!0)}i instanceof n?i.update("entry",t):this._async(function(){i.update("entry",t)})}},_exit:function(){this.isActive()&&(this.notify("states","exit"),this._deactivate())},_completion:function(){this._deactivate(),h.isNull(this.parent)||h.every(this.parent.children,function(t){return!t.isActive()})&&this.notify("parent","completion")}}),t.exports=i},{"./base-state":7,"./elem":8,"./logger":10,"./machines":11,"./pseudo-states":15,"./states":17,"./transition":19,"./util":20,underscore:3}],17:[function(t,e,n){"use strict";var r=t("underscore"),i=t("./base-state"),s=t("./logger"),o=t("./util"),a=t("./mixin"),u=Math.max,c=function(t,e){i.call(this,t),e=r.defaults(e||{},r.clone(c.options)),r.isObject(e.data)&&!r.isFunction(e.data)&&this.set(e.data),this.save(),r.isObject(e.props)&&!r.isFunction(e.props)&&this.addProp(e.props),r.isObject(e.methods)&&!r.isFunction(e.methods)&&this.addMethod(e.methods),this.entryAction=e.entryAction,this.exitAction=e.exitAction,this.doActivity=e.doActivity,this.autoTransition=e.autoTransition,this._loop=e.loop,this._fps=e.fps,this._interval=1e3/this._fps,this._timerId=0,this._lastCallTime=0};c.options={entryAction:r.noop,exitAction:r.noop,doActivity:r.noop,autoTransition:!1,loop:!1,fps:60},c.prototype=r.create(i.prototype,{constructor:c,_cname:"State",getTicks:function(){if(this._loop)return this._ticks;s.error("Stateインスタンスのloopオプションが指定されてません。")},getElapsedTime:function(){if(this._loop)return this._elapsedTime;s.error("Stateインスタンスのloopオプションが指定されてません。")},completion:function(){var e=r.toArray(arguments);this.isActive()||s.error(this._cname+'インスタンス"'+this._name+'"はすでに非アクティブ化されています。'),this._async(function(){var t;r.isNull(this.container)||(t=o.findNextTransition(this.container,this),r.isUndefined(t)?(this._exit(),this.notify("container","completion")):t.trigger.apply(t,e))})},update:function(t){var e=r.toArray(arguments).slice(1);switch(t){case"entry":this._entry.apply(this,e);break;case"exit":this._exit.apply(this,e);break;case"refresh":this._refresh.apply(this,e);break;case"completion":this.completion.apply(this,e)}},_setTimer:function(e){var n;e=r.bind(e,this),this._startTime=0,this._elapsedTime=0,this._ticks=0,this._timerId=0,(n=r.bind(function(){var t=this._tick(e);this._timerId=setTimeout(n,t)},this))()},_clearTimer:function(){clearTimeout(this._timerId)},_tick:function(t){var e,n,i;return e=r.now(),0===this._startTime?(this._startTime=e,n=0):(n=e-this._lastTime,this._elapsedTime=e-this._startTime),this._lastTime=e,this._ticks+=1,t(n),i=r.now()-e,u(this._interval-i,0)},_activate:function(){var t=o.findRelatedTransition(this);this._status="active",s.info(this._cname+'インスタンス"'+this._name+'"がアクティブ化されました。'),this.entryAction(t),this.notify("root","prev-activity",this),this.notify("root","async-activity",r.bind(function(){var e=o.findRelatedTransition(this);this._loop?this._setTimer(function(t){this.doActivity(t,e),this.autoTransition&&this.completion()}):(this.doActivity(e),this.autoTransition&&this.completion())},this)),this.notify("root","after-activity",this)},_deactivate:function(){var t=o.findRelatedTransition(this);this._clearTimer(),r.isNull(this.container)||this.notify("container","set-previous-state",this),this.exitAction(t),this._status="inactive",s.info(this._cname+'インスタンス"'+this._name+'"が非アクティブ化されました。')},_entry:function(t){this.isActive()||(this._activate(),this.notify("children","entry",t))}});var h=function(t){i.call(this,t)};h.prototype=r.create(i.prototype,r.extend({constructor:h,_cname:"FinalState",_activate:function(){this._status="active",s.info('FinalStateインスタンス"'+this._name+'"がアクティブ化されました。'),this.completion()},_deactivate:function(){this._status="inactive",r.isNull(this.container)||this.notify("container","set-previous-state",null),s.info('FinalStateインスタンス"'+this._name+'"が非アクティブ化されました。')}},a.disable)),e.exports={State:c,FinalState:h}},{"./base-state":7,"./logger":10,"./mixin":12,"./util":20,underscore:3}],18:[function(t,e,n){"use strict";var o=t("underscore"),i=function(){this._observers={}};i.prototype=o.create(Object.prototype,{constructor:i,_cname:"Subject",hasObserver:function(t,e){var n=!1;return o.isUndefined(this._observers[t])||-1<o.indexOf(this._observers[t],e)&&(n=!0),n},countObservers:function(t){var e=0;return o.isUndefined(this._observers[t])||(e=this._observers[t].length),e},setObserverType:function(t){var e,n,i;for(n=0,i=(t=o.isArray(t)?t:o.toArray(arguments)).length;n<i;n+=1)e=t[n],o.isUndefined(this._observers[e])&&(this._observers[e]=[])},addObserver:function(t,e){o.isUndefined(this._observers[t])&&(this._observers[t]=[]),o.isObject(e)&&!o.isFunction(e)&&this._observers[t].push(e)},removeObserver:function(t,e){var n,i;n=this._observers[t],o.isUndefined(n)||-1<(i=o.indexOf(n,e))&&n.splice(i,1)},notify:function(t){var e,n,i,r,s;if(e=this._observers[t],!o.isUndefined(e))for(n=0,i=e.length;n<i;n+=1)r=e[n],o.isFunction(r.update)&&(s=o.toArray(arguments).slice(1),r.update.apply(r,s))}}),e.exports=i},{underscore:3}],19:[function(t,e,n){"use strict";var r=t("underscore"),s=(t("./observable"),t("./elem")),o=t("./base-state"),a=t("./states").FinalState,u=t("./pseudo-states").InitialPseudoState,c=t("./pseudo-states").TerminatePseudoState,h=t("./logger"),l=t("./util"),f=(t("./mixin"),function(t,e,n,i){s.call(this,t),this._type="transition",e===a?h.error("終了状態を遷移元にすることはできません。"):e instanceof c?h.error("停止状態を遷移元にすることはできません。"):e instanceof o||l.isFalsy(e)||u?this._rawSource=e:h.error("第2引数に遷移元のStateインスタンス、またはfalseを指定してください。"),n===u?h.error("開始擬似状態を遷移先にすることはできません。"):n instanceof o||l.isFalsy(n)||a?this._rawTarget=n:h.error("第3引数に遷移先のStateインスタンス、またはfalseを指定してください。"),i=r.defaults(i||{},r.clone(f.options)),r.isObject(i.data)&&!r.isFunction(i.data)&&this.set(i.data),this.save(),r.isObject(i.props)&&!r.isFunction(i.props)&&this.addProp(i.props),r.isObject(i.methods)&&!r.isFunction(i.methods)&&this.addMethod(i.methods),this.container=null,this.source=null,this.target=null,this.guard=i.guard,this.effect=i.effect,this.internal=i.internal,this.internal&&this._rawSource!==this._rawTarget&&h.error("遷移元と遷移先は同じStateインスタンスを指定してください。"),this.locked=i.locked,this._watcher={listener:null,cache:null},this._isExplicitEntry=!1,this._exitViaExitPoint=!1,this.setObserverType("container")});f.options={guard:null,effect:null,internal:!1,locked:!0},f.prototype=r.create(s.prototype,{constructor:f,_cname:"Transition",test:function(){var t=!1;try{!this.isActive()&&this.container.isActive()&&this.source.isActive()&&!this.target.isActive()&&(t=!0)}catch(t){return!1}return t},trigger:function(){var e=r.toArray(arguments);if(this.isActive()&&h.error('Transitionインスタンス"'+this._name+'"はすでにアクティブ化されています。'),this.container.isActive()?this.source.isActive()?this.target.isActive()&&h.error("遷移先"+this.target._cname+'インスタンス"'+this.target._name+'"がアクティブです。'):h.error("遷移元"+this.source._cname+'インスタンス"'+this.source._name+'"が非アクティブです。'):h.error('Transitionインスタンス"'+this._name+'"のコンテナが非アクティブです。'),r.isNull(this.guard)||this.guard.apply(this,e)){if(this.internal){if(this.source===this.target)return void this._async(function(){h.info("内部遷移を実行します。"),r.isNull(this.effect)||this.effect.apply(this,e)});h.error("遷移元と遷移先は同じStateインスタンスを指定してください。")}this._async(function(){var t={priority:null,deepHistory:!1};this._entry(),this._exitViaExitPoint?this.source.notify("parent","exit"):this.notify("source","exit"),r.isNull(this.effect)||this.effect.apply(this,e),t.deepHistory=!!l.findDeepHistoryPseudoState(this.container),this._isExplicitEntry?(t.priority=this.target,this.target.notify("parent","entry",t)):this.notify("target","entry",t),this._exit()})}else h.info("ガードが成立しませんでした。遷移は発生しません。")},update:function(t){var e=r.toArray(arguments).slice(1);switch(t){case"refresh":this._refresh.apply(this,e)}},getRoot:function(){for(var t=this;!r.isNull(t._getParentState());)t=t._getParentState();return t},_getParentState:function(){var t=null;return r.isNull(this.container)||r.isNull(this.container.parent)||(t=this.container.parent),t},_refresh:function(t){this._depth=t,this.parent=this._getParentState(),this.notify("children","refresh",t)}}),e.exports=f},{"./base-state":7,"./elem":8,"./logger":10,"./mixin":12,"./observable":14,"./pseudo-states":15,"./states":17,"./util":20,underscore:3}],20:[function(s,t,e){"use strict";var h=s("underscore"),n={isFalsy:h.negate(Boolean),eachElem:function(t,e){var n,i,r,s,o,a;for(e(t),n=0,r=t.children.length;n<r;n+=1){for(e(o=t.children[n]),i=0,s=o.children.transitions.length;i<s;i+=1)e(o.children.transitions[i]);for(i=0,s=o.children.states.length;i<s;i+=1)a=o.children.states[i],this.eachElem(a,e)}},findDeepHistoryPseudoState:function(t){var e;return t.hasHistory(!0)?t._historyPseudo:(e=t._getUpperContainer(),h.isNull(e)?void 0:this.findDeepHistoryPseudoState(e))},findFirstTransition:function(t,e){var n;return s("./pseudo-states").EntryPointPseudoState,n=t.children.transitions,h.isUndefined(e)&&(e=t._initialPseudo),h.find(n,function(t){return t.source===e})},findNextTransition:function(t,e,n){var i,r;return i=s("./pseudo-states").ExitPointPseudoState,r=t.children.transitions,h.find(r,function(t){return h.isUndefined(n)?e instanceof i?t.source===e:t.source===e&&!t.locked:t.source===e&&t.target===n})},findState:function(t,e,n){var i,r,s,o,a,u,c;if(0<=(n=h.isUndefined(n)?1/0:n))for(n-=1,i=0,s=t.children.states.length;i<s;i+=1){if((a=t.children.states[i])===e)return a;for(r=0,o=a.children.length;r<o;r+=1)if(u=a.children[r],c=this.findState(u,e,n),!h.isUndefined(c))return c}},findRelatedTransition:function(e){var t,n;return t=e.container,h.isNull(t)||(n=h.find(t.children.transitions,function(t){return t.isActive()&&(t.source===e||t.target===e)})),n}};t.exports=n},{"./pseudo-states":15,underscore:3}],"async-fsm":[function(t,e,n){var i,r,s,o,a,u,c,h,l,f,d,p;r=t("./logger"),s=t("./states").State,o=t("./states").FinalState,a=t("./machines").Machine,u=t("./machines").SubMachine,c=t("./pseudo-states").InitialPseudoState,h=t("./pseudo-states").HistoryPseudoState,l=t("./pseudo-states").TerminatePseudoState,f=t("./pseudo-states").ChoicePseudoState,d=t("./pseudo-states").EntryPointPseudoState,p=t("./pseudo-states").ExitPointPseudoState,i={logger:r,Machine:a,State:s,Transition:t("./transition"),Region:t("./region"),InitialPseudoState:c,FinalState:o,SubMachine:u,HistoryPseudoState:h,TerminatePseudoState:l,ChoicePseudoState:f,EntryPointPseudoState:d,ExitPointPseudoState:p},e.exports=i},{"./logger":10,"./machines":11,"./pseudo-states":15,"./region":16,"./states":17,"./transition":19}]},{},[]);
//# sourceMappingURL=async-fsm.min.js.map
